(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&t(c)}).observe(document,{childList:!0,subtree:!0});function r(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(e){if(e.ep)return;e.ep=!0;const s=r(e);fetch(e.href,s)}})();class i{constructor(n,r){this.timeStamp=Date.now(),this.type=n,this.id=crypto.randomUUID(),r&&Object.assign(this,r)}toJson(){return Object.fromEntries(Object.entries(this).filter(([n,r])=>{try{return JSON.stringify(r),!0}catch{return!1}}))}resolve(){}}const d=document.createElement("div");d.style.display="none";document.body.appendChild(d);class l extends EventTarget{constructor(){super(...arguments),this.actionHandlers={}}connect(){this.client=new h;const n=async()=>{await this.onload(),this.client.send(new i("ready")),this.dispatchEvent(new CustomEvent("ready")),await this.onready()};return document.readyState==="complete"||document.readyState==="interactive"?setTimeout(n,1):window.addEventListener("DOMContentLoaded",n),new ResizeObserver(t=>{for(let e of t){const s=new i("resize",{dimensions:{width:e.contentRect.width,height:e.contentRect.height}});this.client.send(s)}}).observe(document.querySelector("html")),this.client.on("state",t=>{if(!p(t))throw new TypeError("Message doesn't match type StateMessage");this.setState(t.state)}),this.client.on("action",async t=>{if(!u(t))throw new TypeError("Message doesn't match type AppletMessage.");Object.keys(this.actionHandlers).includes(t.actionId)&&await this.actionHandlers[t.actionId](t.params),t.resolve()}),this}setActionHandler(n,r){this.actionHandlers[n]=r}async setState(n){const r=new i("state",{state:n});await this.client.send(r),this.state=n,this.dispatchEvent(new CustomEvent("render")),this.onrender()}onload(){}onready(){}onrender(){}}function u(o){return o.type==="action"}function p(o){return o.type==="state"}class h{on(n,r){window.addEventListener("message",t=>{if(t.data.type!==n)return;const e=new i(t.data.type,t.data);e.resolve=()=>{window.parent.postMessage(new i("resolve",{id:e.id}),"*")},r(e)})}send(n){return window.parent.postMessage(n.toJson(),"*"),new Promise(r=>{const t=e=>{e.data.type==="resolve"&&e.data.id===n.id&&(window.removeEventListener("message",t),r())};window.addEventListener("message",t)})}}const w=new l,f=document.getElementById("name"),a=w.connect();a.setActionHandler("set_name",({name:o})=>{a.setState({name:o})});a.onrender=()=>{f.innerText=a.state.name};
